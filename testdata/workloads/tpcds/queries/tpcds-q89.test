====
---- QUERY: TPCDS-Q89
select * from (select  *
from (
select i_category, i_class, i_brand,
       s_store_name, s_company_name,
       d_moy,
       sum(ss_sales_price) sum_sales,
       avg(sum(ss_sales_price)) over
         (partition by i_category, i_brand, s_store_name, s_company_name)
         avg_monthly_sales
from item, store_sales, date_dim, store
where ss_item_sk = i_item_sk and
      ss_sold_date_sk = d_date_sk and
      ss_store_sk = s_store_sk and
      d_year in (1999) and
        ((i_category in ('Children','Music','Home') and
          i_class in ('toddlers','pop','lighting')
         )
      or (i_category in ('Jewelry','Books','Sports') and
          i_class in ('costume','travel','football')
        ))
group by i_category, i_class, i_brand,
         s_store_name, s_company_name, d_moy) tmp1
where case when (avg_monthly_sales <> 0) then (abs(sum_sales - avg_monthly_sales) / avg_monthly_sales) else null end > 0.1
order by sum_sales - avg_monthly_sales, s_store_name
limit 100) tmp2;
---- RESULTS
'Children','toddlers','exportiexporti #1','ought','Unknown',6,19.89,417.00
'Children','toddlers','exportiexporti #1','ought','Unknown',3,57.49,417.00
'Children','toddlers','exportiexporti #1','ese','Unknown',4,27.36,367.67
'Children','toddlers','exportiexporti #1','ation','Unknown',6,25.65,360.45
'Children','toddlers','exportiexporti #1','able','Unknown',3,7.40,340.40
'Music','pop','exportischolar #1','bar','Unknown',7,30.79,349.48
'Music','pop','exportischolar #1','ought','Unknown',6,27.34,343.60
'Children','toddlers','exportiexporti #1','ese','Unknown',6,57.93,367.67
'Children','toddlers','exportiexporti #1','able','Unknown',5,34.87,340.40
'Children','toddlers','exportiexporti #1','eing','Unknown',2,34.87,329.98
'Children','toddlers','exportiexporti #1','bar','Unknown',4,68.51,355.83
'Children','toddlers','exportiexporti #1','ation','Unknown',2,85.92,360.45
'Children','toddlers','exportiexporti #1','ought','Unknown',4,146.11,417.00
'Children','toddlers','exportiexporti #1','ese','Unknown',3,101.24,367.67
'Music','pop','exportischolar #1','ation','Unknown',5,77.59,331.72
'Children','toddlers','exportiexporti #1','ation','Unknown',4,109.87,360.45
'Music','pop','exportischolar #1','ation','Unknown',6,81.26,331.72
'Music','pop','exportischolar #1','able','Unknown',3,175.83,426.09
'Music','pop','exportischolar #1','able','Unknown',4,176.92,426.09
'Children','toddlers','exportiexporti #1','ese','Unknown',7,118.79,367.67
'Music','pop','exportischolar #1','eing','Unknown',5,128.76,361.83
'Music','pop','exportischolar #1','ese','Unknown',4,92.91,317.85
'Children','toddlers','exportiexporti #1','bar','Unknown',7,132.58,355.83
'Music','pop','exportischolar #1','ation','Unknown',4,109.62,331.72
'Music','pop','exportischolar #1','ese','Unknown',6,96.11,317.85
'Children','toddlers','exportiexporti #1','able','Unknown',7,122.17,340.40
'Music','pop','exportischolar #1','ought','Unknown',5,129.52,343.60
'Children','toddlers','exportiexporti #1','eing','Unknown',3,120.24,329.98
'Children','toddlers','exportiexporti #1','able','Unknown',8,135.86,340.40
'Music','pop','exportischolar #2','ese','Unknown',8,5.68,209.52
'Music','pop','exportischolar #1','eing','Unknown',4,159.76,361.83
'Music','pop','exportischolar #2','able','Unknown',3,27.37,225.48
'Children','toddlers','exportiexporti #1','eing','Unknown',6,133.10,329.98
'Music','pop','exportischolar #1','ese','Unknown',8,125.56,317.85
'Music','pop','exportischolar #2','able','Unknown',2,34.20,225.48
'Children','toddlers','exportiexporti #1','eing','Unknown',5,141.31,329.98
'Music','pop','exportischolar #2','ese','Unknown',7,21.02,209.52
'Music','pop','exportischolar #1','bar','Unknown',6,161.20,349.48
'Music','pop','exportischolar #1','ought','Unknown',9,157.42,343.60
'Music','pop','exportischolar #1','eing','Unknown',7,176.33,361.83
'Children','toddlers','exportiexporti #1','ation','Unknown',5,182.18,360.45
'Music','pop','exportischolar #2','ese','Unknown',4,32.68,209.52
'Children','toddlers','exportiexporti #1','able','Unknown',10,165.22,340.40
'Music','pop','exportischolar #2','ese','Unknown',3,38.05,209.52
'Music','pop','exportischolar #1','eing','Unknown',9,192.32,361.83
'Music','pop','exportischolar #1','bar','Unknown',4,183.53,349.48
'Music','pop','exportischolar #1','ought','Unknown',7,179.89,343.60
'Music','pop','exportischolar #1','able','Unknown',7,263.93,426.09
'Children','toddlers','exportiexporti #1','bar','Unknown',5,193.70,355.83
'Music','pop','exportischolar #2','eing','Unknown',3,7.38,169.24
'Children','toddlers','exportiexporti #1','ought','Unknown',5,258.30,417.00
'Music','pop','exportischolar #2','able','Unknown',5,70.72,225.48
'Music','pop','exportischolar #2','eing','Unknown',6,16.13,169.24
'Music','pop','exportischolar #2','eing','Unknown',7,19.55,169.24
'Music','pop','exportischolar #2','ation','Unknown',2,16.40,163.70
'Children','toddlers','exportiexporti #1','ought','Unknown',7,269.70,417.00
'Music','pop','exportischolar #1','eing','Unknown',2,215.30,361.83
'Music','pop','exportischolar #2','eing','Unknown',2,24.03,169.24
'Children','toddlers','exportiexporti #2','able','Unknown',4,18.03,161.25
'Music','pop','exportischolar #1','ation','Unknown',2,190.12,331.72
'Music','pop','exportischolar #1','ese','Unknown',5,176.92,317.85
'Music','pop','exportischolar #2','bar','Unknown',5,25.83,165.80
'Children','toddlers','exportiexporti #1','bar','Unknown',8,220.28,355.83
'Music','pop','exportischolar #1','able','Unknown',2,291.65,426.09
'Music','pop','exportischolar #2','ation','Unknown',6,29.94,163.70
'Music','pop','exportischolar #1','bar','Unknown',2,219.04,349.48
'Children','toddlers','exportiexporti #1','ese','Unknown',9,237.41,367.67
'Music','pop','exportischolar #2','ese','Unknown',9,80.55,209.52
'Music','pop','exportischolar #2','bar','Unknown',6,37.56,165.80
'Music','pop','exportischolar #1','ese','Unknown',7,193.17,317.85
'Children','toddlers','exportiexporti #1','ese','Unknown',8,246.38,367.67
'Children','toddlers','exportiexporti #2','able','Unknown',1,40.09,161.25
'Music','pop','exportischolar #2','ation','Unknown',3,42.56,163.70
'Music','pop','exportischolar #1','ese','Unknown',2,196.95,317.85
'Children','toddlers','exportiexporti #2','ought','Unknown',4,15.83,135.74
'Children','toddlers','exportiexporti #2','ation','Unknown',5,15.95,135.57
'Children','toddlers','exportiexporti #2','able','Unknown',9,42.14,161.25
'Music','pop','exportischolar #1','bar','Unknown',3,230.96,349.48
'Children','toddlers','exportiexporti #2','eing','Unknown',6,14.02,129.03
'Children','toddlers','exportiexporti #2','eing','Unknown',4,15.38,129.03
'Children','toddlers','exportiexporti #1','ought','Unknown',9,304.39,417.00
'Children','toddlers','exportiexporti #1','ese','Unknown',5,259.99,367.67
'Music','pop','exportischolar #1','ese','Unknown',1,210.21,317.85
'Children','toddlers','exportiexporti #2','ation','Unknown',1,32.47,135.57
'Children','toddlers','exportiexporti #2','ought','Unknown',5,37.35,135.74
'Music','pop','exportischolar #2','able','Unknown',6,127.24,225.48
'Children','toddlers','exportiexporti #1','eing','Unknown',7,236.80,329.98
'Children','toddlers','exportiexporti #2','ese','Unknown',5,20.71,111.78
'Music','pop','exportischolar #2','ought','Unknown',5,73.53,164.26
'Children','toddlers','exportiexporti #2','ought','Unknown',6,45.28,135.74
'Children','toddlers','exportiexporti #2','ation','Unknown',10,45.50,135.57
'Music','pop','exportischolar #1','ese','Unknown',3,227.84,317.85
'Children','toddlers','exportiexporti #2','bar','Unknown',8,50.21,138.73
'Children','toddlers','exportiexporti #2','ese','Unknown',2,23.26,111.78
'Sports','football','corpnameless #6','able','Unknown',12,51.78,139.99
'Books','travel','univunivamalg #8','eing','Unknown',10,14.90,102.64
'Home','lighting','namelessbrand #3','ought','Unknown',6,11.29,98.75
'Music','pop','exportischolar #1','ought','Unknown',4,257.01,343.60
'Children','toddlers','exportiexporti #1','ation','Unknown',7,274.17,360.45
'Children','toddlers','exportiexporti #2','ese','Unknown',8,26.23,111.78
---- TYPES
STRING, STRING, STRING, STRING, STRING, INT, DECIMAL, DECIMAL
====